@using TaskFlow.Domain
@using DomainTaskStatus = TaskFlow.Domain.TaskStatus

<div class="tf-board">
    @foreach (var status in BoardStatuses)
    {
        var boardTasks = GetBoardTasks.Invoke(status);
        <div class="tf-board-dropzone"
             @ondragover:preventDefault
             @ondrop:preventDefault
             @ondrop="() => OnDropToStatus.Invoke(status)">
            <MudPaper Class="tf-board-column" Elevation="0">
                <MudText Typo="Typo.subtitle2">@status (@boardTasks.Count)</MudText>
                @foreach (var task in boardTasks)
                {
                    <MudPaper Class="@GetTaskContainerClass.Invoke(task, false)" Elevation="1" draggable="true" @ondragstart="() => OnDragStart.Invoke(task.Id)" @onclick="() => OnSelectTask.Invoke(task.Id)">
                        <TaskCard Item="task"
                                  BoardStatuses="BoardStatuses"
                                  OnToggleComplete="() => OnToggleComplete.Invoke(task)"
                                  OnToggleFocus="() => OnToggleFocus.Invoke(task)"
                                  OnToggleImportant="() => OnToggleImportant.Invoke(task)"
                                  OnUpdateTitle="value => OnUpdateTitle.Invoke(task, value)"
                                  OnUpdateNote="value => OnUpdateNote.Invoke(task, value)"
                                  OnUpdatePriority="value => OnUpdatePriority.Invoke(task, value)"
                                  OnUpdateStatus="value => OnUpdateStatus.Invoke(task, value)"
                                  OnToggleToday="() => OnToggleToday.Invoke(task)"
                                  OnDuplicate="() => OnDuplicate.Invoke(task)"
                                  OnDelete="() => OnDelete.Invoke(task)"
                                  OnRequestMove="() => OnRequestMove.Invoke(task.Id)" />
                    </MudPaper>
                }
                @if (boardTasks.Count == 0)
                {
                    <MudText Typo="Typo.caption" Class="tf-board-empty">Drop tasks here</MudText>
                }
            </MudPaper>
        </div>
    }
</div>

@code {
    [Parameter, EditorRequired]
    public IReadOnlyList<DomainTaskStatus> BoardStatuses { get; set; } = [];

    [Parameter, EditorRequired]
    public Func<DomainTaskStatus, List<TaskFlow.Domain.Task>> GetBoardTasks { get; set; } = null!;

    [Parameter, EditorRequired]
    public Func<DomainTaskStatus, System.Threading.Tasks.Task> OnDropToStatus { get; set; } = null!;

    [Parameter, EditorRequired]
    public Action<Guid> OnDragStart { get; set; } = null!;

    [Parameter, EditorRequired]
    public Action<Guid> OnSelectTask { get; set; } = null!;

    [Parameter, EditorRequired]
    public Func<TaskFlow.Domain.Task, bool, string> GetTaskContainerClass { get; set; } = null!;

    [Parameter, EditorRequired]
    public Func<TaskFlow.Domain.Task, System.Threading.Tasks.Task> OnToggleComplete { get; set; } = null!;

    [Parameter, EditorRequired]
    public Func<TaskFlow.Domain.Task, System.Threading.Tasks.Task> OnToggleFocus { get; set; } = null!;

    [Parameter, EditorRequired]
    public Func<TaskFlow.Domain.Task, System.Threading.Tasks.Task> OnToggleImportant { get; set; } = null!;

    [Parameter, EditorRequired]
    public Func<TaskFlow.Domain.Task, string, System.Threading.Tasks.Task> OnUpdateTitle { get; set; } = null!;

    [Parameter, EditorRequired]
    public Func<TaskFlow.Domain.Task, string, System.Threading.Tasks.Task> OnUpdateNote { get; set; } = null!;

    [Parameter, EditorRequired]
    public Func<TaskFlow.Domain.Task, TaskPriority, System.Threading.Tasks.Task> OnUpdatePriority { get; set; } = null!;

    [Parameter, EditorRequired]
    public Func<TaskFlow.Domain.Task, DomainTaskStatus, System.Threading.Tasks.Task> OnUpdateStatus { get; set; } = null!;

    [Parameter, EditorRequired]
    public Func<TaskFlow.Domain.Task, System.Threading.Tasks.Task> OnToggleToday { get; set; } = null!;

    [Parameter, EditorRequired]
    public Func<TaskFlow.Domain.Task, System.Threading.Tasks.Task> OnDuplicate { get; set; } = null!;

    [Parameter, EditorRequired]
    public Func<TaskFlow.Domain.Task, System.Threading.Tasks.Task> OnDelete { get; set; } = null!;

    [Parameter, EditorRequired]
    public Action<Guid> OnRequestMove { get; set; } = null!;
}
